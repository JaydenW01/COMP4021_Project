<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" href="./assets/charlie/icon.jpg" />
    <link
      href="https://fonts.googleapis.com/css?family=Audiowide"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Bruno+Ace+SC&family=Darumadrop+One&display=swap"
      rel="stylesheet"
    />
    <link href="styles.css" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://kit.fontawesome.com/5b54f3d95e.js" crossorigin="anonymous"></script>
    <title>COMP4021 Bomberman</title>
  </head>
  <body>
    <div class="canvas-container">
      <canvas id="canvas"></canvas>
      <div id="signin-overlay" class="overlay row">
        <div class="content shadow row">
            <form id="signin-form" class="col">
                <div class="caption">SIGN IN</div>
                <div class="spacer-0"></div>
                <input id="signin-username" placeholder="Enter your username"></input>
                <input id="signin-password" type="password" placeholder="Enter your password"></input>
                <div class="spacer-0"></div>
                <button type="submit">Sign In</button>
                <div id="signin-message" class="warning center"></div>
                <div class="spacer-grow"></div>
            </form>

            <div class="spacer-0"></div>

            <form id="register-form" class="col">
                <div class="caption">REGISTER A NEW ACCOUNT</div>
                <div class="spacer-0"></div>
                <input id="register-username" maxlength="10" placeholder="Enter your username"></input>
                <input id="register-name" maxlength="16" placeholder="Enter your name"></input>
                <input id="register-password" type="password" placeholder="Enter your password"></input>
                <input id="register-confirm" type="password" placeholder="Enter your password again"></input>
                <div class="spacer-0"></div>
                <button type="submit">Register</button>
                <div id="register-message" class="warning center"></div>
            </form>
        </div>
    </div>
      <!-- menu page -->
      <div id="menu">
        <h1 style="font-size: 60px;">Game Menu</h2>
        <div class="button-50"  id="game-start">
            <!-- <div>
              <i class="fa-solid fa-gamepad"></i>
            </div> -->
            <div></div>
            <div>Start Game</div>
        </div>
        <div class="button-50" onclick="gameStat.enterStat()">
            <!-- <div>
                <i class="far fa-chart-bar"></i>
            </div> -->
            <div></div>
            <div>Game Stats</div>
        </div>
        <div class="button-50" onclick="gameInfo.enterGameInfo()">
            <!-- <div>
                <i class="far fa-question-circle"></i>
            </div> -->
            <div></div>
            <div>
                Game Info
            </div>
        </div>
        <div class="button-50" onclick="gameMenu.signout()">
          <!-- <div>
            <i class="fa-solid fa-arrow-right-from-bracket"></i>
          </div> -->
          <div></div>
          <div>
              Sign Out
          </div>
        </div>
      </div>
      <!-- character page -->
      <div id="character-lobby" style="display: none;">
          <h1 style="font-size: 30px;">Choose one character</h2>
          <div class="character-container">
            <img src="assets/charlie/player1.png" class="player-image" data-color="blue">
            <img src="assets/charlie/player2.png" class="player-image" data-color="red">
            <img src="assets/charlie/player3.png" class="player-image" data-color="yellow">
            <img src="assets/charlie/player4.png" class="player-image" data-color="black">
          </div>
          <div class="button-container">
            <button id="back-button">Back</button>   
            <button id="ok-button">OK</button>
          </div>
           
      </div>

      <!-- game lobby page -->
      <div id="game-lobby" style="display: none;">
        <div class="lobby-boxes">
          <div class="lobby-box" id="lobby-player1">
            <div class="player-joined">
              <div class="lobby-heading">
                <div class="player-number"> Player 1</div>
                <div class="player-name"> Tony Lam</div>
              </div>
              <div class="avatar" id="config-skin">
                <img id="avatar-image1" src="assets/charlie/player1.png">
              </div>


              <div class="ready-button" onclick="gameLobby.playerReady(true)">Ready</div>
              <div class="cancel-button" onclick="gameLobby.playerReady(false)">Cancel</div>
            </div>
          </div>
          <div class="lobby-box" id="lobby-game-config">
            <div id="config-time">
              <div>Game Time</div>
              <div class="config-num-block">
                <div class="game-duration">3:00</div>             
              </div>
            </div>

          </div>
          <div class="lobby-box" id="lobby-player2">
              <div class="player-joined">
                <div class="lobby-heading">
                  <div class="player-number"> Player 2</div>
                  <div class="player-name"> Tony Lam</div>
                </div>
                <div class="avatar" id="config-skin">
                  <img id="avatar-image2" src="assets/charlie/player1.png">
                </div>

                <div class="ready-button" onclick="gameLobby.playerReady(true)">Ready</div>
                <div class="cancel-button" onclick="gameLobby.playerReady(false)">Cancel</div>
              </div>
            </div>
          </div>   
          <button id="back-button-gamelobby">Back</button>        
        </div>

        <!-- game start countdown -->
        <div id="countdown" style="display: none;">0</div>

        <!-- ranking page -->
        <div id="ranking" style="display: none;">
          <table>
            <caption>Leaderboard</caption>
            <thead>
              <tr>
                <th scope="col">Ranking</th>
                <th scope="col">User Name</th>
                <th scope="col">Win</th>
                <th scope="col">Lose</th>
              </tr>
            </thead>
            <tbody id="table-body">
              <tr>
                <td scope="row" data-label="Ranking">1</td>
                <td data-label="Username">Tony</td>
                <td data-label="Wins">3</td>
                <td data-label="Lose">0</td>
              </tr>
              <tr>
                <td scope="row" data-label="Ranking">2</td>
                <td data-label="Username">Terry</td>
                <td data-label="Wins">2</td>
                <td data-label="Lose">1</td>
              </tr>
              <tr>
                <td scope="row" data-label="Ranking">3</td>
                <td data-label="Username">Edward</td>
                <td data-label="Wins">0</td>
                <td data-label="Lose">3</td>
              </tr>
            </tbody>
          </table>
          <div class="back-button" onclick="gameStat.backToMenu()">Back</div>       
        </div>
        <!-- game info page  -->
        <div id="game-info" style="display: none;">
          <div id="game-info-content">
            <div id="game-info-title">Game Information</div>
            <div class="info-block">
              <div class="game-info-header">Description</div>
              <div class="game-info-text">
                This is a 2-player online bomberman game. You need to place bombs to defeat another player within the game time. Otherwise, this will be a draw game.
              </div>
            </div>
            <div class="game-info-row">
              <div class="info-block-minor">
                <div class="game-info-header">Control</div>
                <div class="game-info-text">
                  WASD: Player movement
                  Space: Place bomb
                  C: enable cheating mode
                  V: disable cheating mode
                </div>            
              </div>
              <div class="info-block-minor">
                <div class="game-info-header">Items</div>
                <div class="game-info-text">
                  <!-- <img src="assets/range potion.png"> : + Explosion Range
                  <img src="assets/heart.png"> : + Extra Life
                  <img src="assets/extra bomb.png"> : + Number of Bombs
                  <img src="assets/unbreakable wall.png"> : Unbreakable Wall
                  <img src="assets/breakable wall.png"> : Breakable Wall -->
                </div>            
              </div>
            </div>
          </div>
          <div id="back-button-gameinfo" onclick="gameInfo.backToMenu()">Back</div>       
        </div>
        <!-- game over page -->
        <div id="game-over" style="display: none;">
          <div id="game-over-content">
            Game Over!!
            <!-- <div id="game-result">
              You Win!
            </div>
            <div id="game-over-stat">
              <div id="game-over-player1">
                <div class="game-over-username">
                  Player 1
                </div>
                <div class="game-over-stat-row">
                  Health: 100
                </div>
                <div class="game-over-stat-row">
                  Bomb: 3
                </div>
                <div class="game-over-stat-row">
                  Range: 2
                </div>
              </div>
              <div id="game-over-player2">
                <div class="game-over-username">
                  Player 2
                </div>
                <div class="game-over-stat-row">
                  Health: 60
                </div>
                <div class="game-over-stat-row">
                  Bomb: 2
                </div>
                <div class="game-over-stat-row">
                  Range: 4
                </div>
              </div> -->
            </div>
            <div id="back-button-gameover" onclick="gameOver.backToMenu()">Back To Menu</div>       
          </div>
        </div>
        <div id="clock" style="display: none;">
          <div id="clock-title"> Time left: </div>
          <div id="clock-content">
            <div id="minute">0</div>: <div id="seconds">0</div>
          </div>
        </div>
    </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.1.min.js"></script>
    <script src="scripts/socket.js"></script>
    <script src="scripts/UI.js"></script>
    <script src="scripts/gameLobby.js"></script>
    <script src="scripts/registration.js"></script>
    <script src="scripts/authentication.js"></script>
    <script src="/socket.io/socket.io.min.js"></script>
    <script>
      const menuPage = document.getElementById('menu');
      const characterPage = document.getElementById('character-lobby');
      const gameStartButton = document.getElementById('game-start');
      const backButton = document.getElementById('back-button');
      const backButtonGamelobby = document.getElementById('back-button-gamelobby');
      const gameLobbyPage = document.getElementById('game-lobby');
      const playerNameElements = document.querySelectorAll('.player-name');
      const playerAvatarElements = document.querySelectorAll('.avatar img');
    
      backButton.addEventListener('click', () => {
        menuPage.style.display = 'block';
        characterPage.style.display = 'none';
      });
      backButtonGamelobby.addEventListener('click', () => {
        socket.emit('leaveLobby',JSON.parse(sessionStorage.user).username);
        gameLobbyPage.style.display = 'none';
        characterPage.style.display = 'block';
        Socket.disconnect();
      });
      gameStartButton.addEventListener('click', () => {
        menuPage.style.display = 'none';
        characterPage.style.display = 'block';
      });
    
      const images = document.querySelectorAll('.player-image');
      const socket = io();
      images.forEach(img => {
        img.addEventListener('click', () => {
          images.forEach(img => img.classList.remove('selected'));
          img.classList.add('selected');
        });
      });
    
      const okButton = document.querySelector('#ok-button');

      socket.on('joinedLobby successfully', (lobbyInfoString) => {
        const lobbyInfo = JSON.parse(lobbyInfoString);
        console.log('1');
        console.log(lobbyInfo.players[0].displayName);
        console.log(lobbyInfo);
        if (lobbyInfo.players.length >= 1) {
          console.log(lobbyInfo.players.length);
          console.log(lobbyInfo.players[0].color);
        // Update player 1 name and avatar image
          $('#lobby-player1 .player-name').text(lobbyInfo.players[0].displayName);
          if(lobbyInfo.players[0].color === 'blue'){
            $('#avatar-image1').attr('src', `assets/charlie/player1.png`);
          }
          if(lobbyInfo.players[0].color === 'red'){
            $('#avatar-image1').attr('src', `assets/charlie/player2.png`);
          }
          if(lobbyInfo.players[0].color === 'yellow'){
            $('#avatar-image1').attr('src', `assets/charlie/player3.png`);
          }
          if(lobbyInfo.players[0].color === 'black'){
            $('#avatar-image1').attr('src', `assets/charlie/player4.png`);
          }
        }

        if (lobbyInfo.players.length === 2) {
        // Update player 2 name and avatar image
          $('#lobby-player2 .player-name').text(lobbyInfo.players[1].displayName);
          if(lobbyInfo.players[1].color === 'blue'){
            $('#avatar-image2').attr('src', `assets/charlie/player1.png`);
          }
          if(lobbyInfo.players[1].color === 'red'){
            $('#avatar-image2').attr('src', `assets/charlie/player2.png`);
          }
          if(lobbyInfo.players[1].color === 'yellow'){
            $('#avatar-image2').attr('src', `assets/charlie/player3.png`);
          }
          if(lobbyInfo.players[1].color === 'black'){
            $('#avatar-image2').attr('src', `assets/charlie/player4.png`);
          }
        }
      });

      okButton.addEventListener('click', () => {
        Socket.connect();
        const selectedImage = document.querySelector('.player-image.selected');
        const selectedColor = selectedImage ? selectedImage.dataset.color : null;
    
        if (selectedColor) {
          console.log(selectedColor);
          console.log("OK button clicked");
          const userobject = JSON.parse(sessionStorage.getItem("user"));
          socket.emit('joinLobby', JSON.stringify({username:userobject.username,displayName:userobject.displayName,colour:selectedColor}));
          gameLobbyPage.style.display = 'block';
          characterPage.style.display = 'none';
        }
        else {
          console.log("Please select a character");
        }


      });

    </script>

    <!-- Sprite -->
    <!-- <script src="scripts/Player.js"></script>
    <script src="scripts/MapItems.js" ></script>
    <script src="scripts/Sprite.js"></script>
    <script src="scripts/BoundingBox.js"></script>
    <script src="scripts/Bomb.js"></script>
    <script src="scripts/PowerUps.js"></script>
    <script src="scripts/bomberman.js"></script> -->
    <script>
      $(document).ready(function () {
        // Initialize the UI
        SignInForm.initialize();
        
        // Validate the signin
        Authentication.validate(
          () => { SignInForm.hide(); },
          () => { SignInForm.show(); }
        );
      });
    </script>
  </body>
</html>
